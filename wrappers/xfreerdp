#!/bin/bash -e

SCRIPT_NAME="$(basename "$0")"
case "$SCRIPT_NAME" in
xfreerdp|wlfreerdp)
	APP_NAME="$SCRIPT_NAME" ;;
*)
	APP_NAME="xfreerdp" ;;
esac

OPTIONS=(
	/size:2560x1440
	/dynamic-resolution
	/scale:140
	/sound:sys:pulse
	/floatbar:show:fullscreen
	+auto-reconnect
)

OPTIONS_BEST=(
	/network:auto

	# XXX: for some reason Win10 prefers progressive to avc, so do not advertise it
	# XXX: order matters with freerdp 2.10 (not in master)
	/gfx:rfx,avc420,avc444
	/rfx-mode:video
	/gdi:hw
)

OPTIONS_FASTEST=(
	-aero
	-themes
	-wallpaper
	-fonts
	-window-drag
	-menu-anims
	/bpp:8
	+compression
	/compression-level:2
	+bitmap-cache
	+glyph-cache
	+offscreen-cache
	/network:modem

	# XXX: for some reason Win10 prefers progressive to avc, so do not advertise it
	# XXX: order matters with freerdp 2.10 (not in master)
	/gfx:rfx,avc420,avc444
	/rfx-mode:video
	/gdi:hw

	#/rfx # RemoteFxCodec
	#/gfx:rfx # RemoteFxCodec
	#/gfx:progressive # GfxProgressive
	#/gfx:avc420 # GfxH264
	#/gfx:avc444 # GfxAVC444
	#+gfx-progressive # == /gfx:progressive
	#-gfx-thin-client # == /gfx:thin-client, implies /gfx:small-cache
	#-gfx-small-cache # == /gfx:small-cache
)

ARGS=()
for arg; do
	case "$arg" in
	/best)
		ARGS+=( "${OPTIONS_BEST[@]}" ) ;;
	/fast|/fastest|/worst)
		ARGS+=( "${OPTIONS_FASTEST[@]}" ) ;;
	/u:intelfx|/u:intelfx@intelfx.name)
		ARGS+=( /admin -sec-nla ) ;&
	*)
		ARGS+=( "$arg" ) ;;
	esac
	shift
done

exec "/usr/bin/$APP_NAME" "${OPTIONS[@]}" "${ARGS[@]}"
